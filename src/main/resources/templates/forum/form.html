<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="#{forum.new.title} + ' - HobbySwap'">ç™¼è¡¨æ–°è©±é¡Œ - HobbySwap</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .forum-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }
        .forum-header {
            font-family: 'Archivo Black', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-transform: uppercase;
        }

        .input-brutal:focus {
            outline: none;
            border-color: var(--highlight);
            box-shadow: 4px 4px 0px #000;
        }

        label {
            display: block;
            font-family: 'Space Mono', monospace;
            font-weight: bold;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .action-box {
            text-align: left !important;
        }

        .input-brutal,
        textarea.input-brutal {
            text-align: left !important;
            padding-left: 30px;
        }

        select.input-brutal {
            text-align: left;
            padding-left: 10px;
        }

        .lang-dropdown {
            position: relative;
            width: auto;
        }

        .action-box .lang-dropdown {
            width: 100%;
        }

        .lang-btn {
            display: flex;
            align-items: center;
            padding-left: 15px !important;
            text-align: left !important;
            font-family: 'Space Mono', monospace;
        }

        .lang-content {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background-color: white;
            border: 2px solid black;
            border-top: none;
            z-index: 1000;
            display: none;
        }

        .lang-dropdown:hover .lang-content {
            display: block;
        }

        .lang-content a {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: black;
            border-bottom: 1px solid #eee;
            font-family: 'Space Mono', monospace;
            cursor: pointer; /* å¢åŠ æ‰‹å‹æ¸¸æ¨™ */
        }

        .lang-content a:hover {
            background-color: #000;
            color: #fff;
        }

        .lang-content a:last-child {
            border-bottom: none;
        }

        ::placeholder {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
            color: #999;
            font-weight: normal;
            opacity: 1;
        }

        .input-brutal {
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="navbar">
    <a th:href="@{/}" class="logo">HobbySwap</a>

    <div class="nav-links">
        <div class="nav-right-group" style="display: flex; align-items: center; gap: 20px;">

            <a th:href="@{/forum}" class="btn"
               style="height:45px; padding:0 20px; font-size:0.9rem; display: inline-flex; align-items: center; justify-content: center; border: 2px solid #000; box-shadow: 3px 3px 0px #000;"
               th:text="#{nav.back_forum}">
                â† FORUM
            </a>

            <a th:href="@{/cart}" class="btn"
               style="height:45px; padding:0 20px; font-size:0.9rem; display: inline-flex; align-items: center; justify-content: center; border: 2px solid #000; box-shadow: 3px 3px 0px #000;"
               th:text="#{nav.cart}">
                ğŸ›’ CART
            </a>


            <span th:if="${#authentication.principal != 'anonymousUser'}" style="display:flex; align-items:center; gap: 20px;">
                <div class="lang-dropdown">
            <button class="lang-btn" style="background: var(--highlight); color: black; border: 2px solid black; min-width: 120px; font-family: 'Space Mono', monospace;">
              <span th:text="${#authentication.principal.name}" style="font-weight:bold;">User</span>
              <span style="font-size: 0.8rem; margin-left: 5px;">â–¼</span>
            </button>
            <div class="lang-content">
                <a th:href="@{/mypage}" th:text="#{nav.mypage}">MY PAGE</a>
                <a th:href="@{/private-chat}" th:text="#{nav.private_chat}">ğŸ’¬ ç§è¨Š</a>
                <a th:href="@{/chat}" th:text="#{nav.chat}">ğŸ’¬ CHAT</a>
                <a th:href="@{/items/new}" th:text="#{nav.sell}">SELL</a>

                <div style="height: 2px; background: black; margin: 0;"></div>

                <a href="javascript:void(0)"
                   onclick="document.getElementById('logout-form').submit();"
                   style="color: red; font-weight: bold;"
                   th:text="#{nav.logout}">LOGOUT</a>
            </div>
        </div>

                <form id="logout-form" th:action="@{/logout}" method="post" style="display: none;">
            </form>
            </span>

            <span th:if="${#authentication.principal == 'anonymousUser'}" style="display:flex; align-items:center; gap: 20px;">
                <a th:href="@{/login}" class="btn" style="height:40px; padding:0 15px; font-size:0.9rem; display: inline-flex; align-items: center; justify-content: center;" th:text="#{nav.login}">LOGIN</a>
            </span>

            <div class="lang-dropdown">
                <button class="lang-btn">
                    <span>ğŸŒ LANGUAGE â–¼</span>
                </button>
                <div class="lang-content">
                    <a th:href="@{?lang=zh_TW}">ç¹é«”ä¸­æ–‡ [TW]</a>
                    <a th:href="@{?lang=en}">ENGLISH [EN]</a>
                    <a th:href="@{?lang=ja}">æ—¥æœ¬èª [JP]</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="forum-container">
    <h2 class="forum-header">START A TOPIC</h2>

    <form th:action="@{/forum/new}" method="post" th:object="${post}" class="action-box"
          style="padding: 40px; border: 3px solid black; width: 1000px; box-shadow: 12px 12px 0px rgba(0,0,0,0.1); background: white;">

        <div style="margin-bottom: 25px;">
            <label th:text="#{forum.label.title}">æ¨™é¡Œ TITLE</label>
            <input type="text" th:field="*{title}" class="input-brutal" required
                   th:placeholder=" ' ' +#{forum.placeholder.title}" style="width: 100%; height: 50px;">
        </div>

        <div style="margin-bottom: 25px; position: relative; z-index: 500;">
            <label th:text="#{forum.label.category}">åˆ†é¡ CATEGORY</label>

            <input type="hidden" th:field="*{category}" id="selected-category">

            <div class="lang-dropdown" style="width: 100%;">
                <button type="button" class="lang-btn" style="width: 100%; justify-content: space-between; height: 50px; border: 2px solid black; box-shadow: 4px 4px 0px #000;">
                    <span id="category-display" th:text="#{forum.placeholder.category}">è«‹é¸æ“‡åˆ†é¡</span>
                    <span>â–¼</span>
                </button>
                <div class="lang-content" style="width: 100%; border: 2px solid black;">
                    <a th:each="cat : ${categories}"
                       href="javascript:void(0)"
                       th:attr="data-value=${cat}, data-display=${cat.display}"
                       onclick="selectOption('category', this.getAttribute('data-value'), this.getAttribute('data-display'))"
                       th:text="${cat.display}">ç§‘æŠ€</a>
                </div>
            </div>
        </div>

        <div style="margin-bottom: 25px; background: var(--highlight); padding: 20px; border: 2px solid black; box-shadow: 5px 5px 0px black; position: relative; z-index: 400;">
            <span th:text="#{forum.label.link_item}">é—œè¯å•†å“</span>

            <input type="hidden" name="sharedItemId" id="selected-item-id">

            <div class="lang-dropdown" style="width: 100%;">

                <div id="item-search-container"
                     style="display: flex; gap: 10px; width: 100%;"
                     th:data-msg-searching="#{forum.search.searching}"
                     th:data-msg-no-result="#{forum.search.no_result}"
                     th:data-msg-failed="#{forum.search.failed}"
                     th:data-msg-cancel="#{forum.option.cancel}">

                    <div id="selected-item-display"
                         th:text="#{forum.item.not_selected}"
                         style="flex: 1; display: flex; align-items: center; padding-left: 15px; background: #eee; border: 2px solid black; font-family: 'Space Mono'; color: #666;">
                        (å°šæœªé¸æ“‡)
                    </div>

                    <input type="text" id="item-keyword"
                           th:placeholder="' ' + #{forum.search.placeholder}"
                           class="input-brutal"
                           style="width: 180px; border: 2px solid black; height: 45px; padding-left: 15px;">

                    <button type="button" onclick="searchItems()" class="btn"
                            style="height: 45px; border: 2px solid black; color: black; padding: 0 15px; box-shadow: 2px 2px 0px #000;">
                        ğŸ” GO
                    </button>
                </div>

                <div id="search-results-dropdown" class="lang-content" style="width: 100%; border: 2px solid black; max-height: 200px; overflow-y: auto;">
                    <div style="padding: 10px 15px; color: #999;" th:text="#{forum.search.hint}">
                        è«‹è¼¸å…¥é—œéµå­—ä¸¦æœå°‹...
                    </div>
                </div>
            </div>
        </div>

        <div style="margin-bottom: 25px;">
            <label th:text="#{forum.label.content}">å…§å®¹ CONTENT</label>
            <textarea th:field="*{content}" rows="8" class="input-brutal" required
                      style="width: 100%; padding: 15px; font-family: 'Space Mono', monospace;"></textarea>
        </div>

        <button type="submit" class="btn"
                style="width: 100%; height: 60px; font-size: 1.2rem; background: #000; color: #fff; border: 3px solid black; box-shadow: 6px 6px 0px rgba(0,0,0,0.2);"
                th:text="#{forum.btn.submit}">ç™¼ä½ˆæ–‡ç« </button>
    </form>
</div>

<footer class="footer">
    <div class="footer-grid">
        <div class="footer-col">
            <h4 th:text="#{footer.company}">COMPANY</h4>
            <ul class="footer-links">
                <li><a href="#" th:text="#{footer.brand}">é—œæ–¼æˆ‘å€‘ BRAND STORY</a></li>
                <li><a href="#" th:text="#{footer.store}">é–€å¸‚è³‡è¨Š STORE</a></li>
                <li><a href="#" th:text="#{footer.privacy}">éš±ç§æ¬Šæ”¿ç­– PRIVACY</a></li>
                <li><a href="#" th:text="#{footer.terms}">æœå‹™æ¢æ¬¾ TERMS</a></li>
            </ul>
        </div>

        <div class="footer-col">
            <h4 th:text="#{footer.service}">SERVICE</h4>
            <ul class="footer-links">
                <li><a href="#" th:text="#{footer.faq}">å¸¸è¦‹å•é¡Œ FAQ</a></li>
                <li><a href="#" th:text="#{footer.delivery}">é‹é€æ”¿ç­– DELIVERY</a></li>
                <li><a href="#" th:text="#{footer.return}">é€€æ›è²¨æœå‹™ RETURN</a></li>
                <li><a href="#" th:text="#{footer.vip}">æœƒå“¡åˆ¶åº¦ VIP</a></li>
            </ul>
        </div>

        <div class="footer-col">
            <h4 th:text="#{footer.contact}">CONTACT US</h4>
            <div class="contact-info">
                <p><strong>TEL:</strong> 02-1234-5678</p>
                <p><strong>EMAIL:</strong> help@hobbyswap.com</p>
                <p><strong>TIME:</strong> MON - SUN / 11:00 - 20:00</p>
            </div>
        </div>

        <div class="footer-col">
            <h4 th:text="#{footer.follow}">FOLLOW US</h4>
            <div class="social-links">
                <a href="#">[ IG ]</a>
                <a href="#">[ FB ]</a>
                <a href="#">[ YT ]</a>
            </div>
        </div>
    </div>

    <div class="copyright">

        <div>
            &copy; <span th:text="#{footer.copyright}">2025 HOBBYSWAP SUPPLY. ALL RIGHTS RESERVED.</span>
        </div>

        <div class="payment-icons">
            <span>VISA</span>
            <span>MASTER</span>
            <span>JCB</span>
            <span>APPLE PAY</span>
        </div>
    </div>
</footer>
<script>
    function selectOption(type, value, displayText) {
        if (type === 'category') {
            document.getElementById('selected-category').value = value;
            document.getElementById('category-display').innerText = displayText;
        } else if (type === 'item') {
            document.getElementById('selected-item').value = value;
            document.getElementById('item-display').innerText = displayText;
        }
    }

    function searchItems() {
    const keyword = document.getElementById('item-keyword').value;
    const dropdown = document.getElementById('search-results-dropdown');

    const container = document.getElementById('item-search-container');
    const msgSearching = container.getAttribute('data-msg-searching'); // æœå°‹ä¸­...
    const msgNoResult = container.getAttribute('data-msg-no-result'); // æ‰¾ä¸åˆ°...
    const msgFailed = container.getAttribute('data-msg-failed');     // å¤±æ•—...
    const msgCancel = container.getAttribute('data-msg-cancel');     // å–æ¶ˆé¸æ“‡...

    if (!keyword.trim()) {
        alert("Please enter keyword!");
        return;
    }

    dropdown.innerHTML = `<div style="padding:10px 15px;">${msgSearching}</div>`;
    dropdown.style.display = 'block';

    fetch('/api/items/search?keyword=' + encodeURIComponent(keyword))
        .then(response => response.json())
        .then(data => {
            dropdown.innerHTML = '';

            const clearOption = document.createElement('a');
            clearOption.href = "javascript:void(0)";
            clearOption.style.color = "#666";
            clearOption.innerText = msgCancel;
            clearOption.onclick = function() { selectItem('', '(Start Over)'); };
            dropdown.appendChild(clearOption);

            if (data.length === 0) {
                const noResult = document.createElement('div');
                noResult.style.padding = "10px 15px";
                noResult.innerText = msgNoResult;
                dropdown.appendChild(noResult);
            } else {
                data.forEach(item => {
                    const link = document.createElement('a');
                    link.href = "javascript:void(0)";
                    link.innerText = `${item.title} ($${item.price})`;
                    link.onclick = function() {
                        selectItem(item.id, `${item.title} ($${item.price})`);
                    };
                    dropdown.appendChild(link);
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            dropdown.innerHTML = `<div style="padding:10px 15px; color:red;">${msgFailed}</div>`;
        });
}

    function selectItem(id, title) {

        document.getElementById('selected-item-id').value = id;

        const display = document.getElementById('selected-item-display');
        display.innerText = title;
        if(id) {
            display.style.background = "white";
            display.style.color = "black";
            display.style.fontWeight = "bold";
        } else {
            display.style.background = "#eee";
            display.style.color = "#666";
            display.style.fontWeight = "normal";
        }

        document.getElementById('search-results-dropdown').style.display = 'none';
    }

    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('search-results-dropdown');
        const input = document.getElementById('item-keyword');
        if (event.target !== input && event.target.closest('.lang-dropdown') === null) {
            dropdown.style.display = 'none';
        }
    });
</script>
</body>
</html>